@startuml
skinparam Shadowing false
skinparam NoteBorderColor #f3f1f6
skinparam NoteBackgroundColor #f3f1f6
skinparam NoteFontSize 12
skinparam ActivityBorderColor none
skinparam ActivityBackgroundColor #7a8da1
skinparam ActivityFontSize 16
skinparam ArrowColor #7aab8a
skinparam ArrowFontSize 16
skinparam ActivityDiamondBackgroundColor #7aab8a
skinparam ActivityDiamondBorderColor #7aab8a
skinparam ActivityDiamondFontSize 18
skinparam defaultFontName DejaVu Serif Condensed
skinparam ActivityEndColor #669580

header
<b>FV2210
2022-12-12
endheader

title
WiM Strom

8.15.1: AD: Abrechnung von Dienstleistungen



end title
:<b>E_0259</b>;
note right
<b><i>Prüfende Rolle: MSB
end note

if (<b>10: </b> Erfüllt die Rechnung weitere Anforderungen gem. §14 Abs. 4 UStG?) then (ja)
else (nein)
    :A01;
    note left
        Cluster: Ablehnung auf Kopfebene
        Rechnung entspricht nicht §14 Abs. 4 UStG
        Hinweis: Die Ablehnung ist zu begründen.
    endnote
    kill;
endif
if (<b>20: </b> Ist das Rechnungsdatum ≤ dem Eingangsdatum?) then (ja)
else (nein)
    :A02;
    note left
        Cluster: Ablehnung auf Kopfebene
        Rechnungsdatum liegt in der Zukunft
    endnote
    kill;
endif
if (<b>30: </b> Ist das Rechnungsdatum < das Ende des Abrechnungszeitraumes/Ausführungsdatums?) then (ja)
    :A03;
    note left
        Cluster: Ablehnung auf Kopfebene
        Das Rechnungsdatum liegt vor dem Ende des Abrechnungszeitraumes/Ausführungsdatums.
    endnote
    kill;
else (nein)
endif
if (<b>40: </b> Ist der Empfänger der Rechnung für den genannten Abrechnungszeitraum/Ausführungsdatum der genannten Messlokation mindestens einen Tag zugeordnet?) then (ja)
else (nein)
    :A04;
    note left
        Cluster: Ablehnung auf Kopfebene
        Der MSB ist der Messlokation nicht einen Tag des Abrechnungszeitraumes/Ausführungsdatums zugeordnet.
    endnote
    kill;
endif
if (<b>50: </b> Ist der Empfänger der Rechnung für den gesamten genannten Abrechnungszeitraum/Ausführungsdatum der genannten Messlokation zugeordnet?) then (ja)
else (nein)
    :A05;
    note left
        Cluster: Ablehnung auf Kopfebene
        Der MSB lehnt die Zahlung ab. Eine Ablehnung der Zahlung wird durch den MSB begründet.
        Hinweis: Der MSB gibt den erwarteten Abrechnungszeitraum/das erwartete Ausführungsdatum an.
    endnote
    kill;
endif
if (<b>60: </b> Liegt vom Rechnungssteller, die in dieser Rechnung verwendete Rechnungsnummer, bereits vor?) then (ja)
    :A06;
    note left
        Cluster: Ablehnung auf Kopfebene
        Rechnungsnummer wurde bereits verwendet
    endnote
    kill;
else (nein)
endif
if (<b>70: </b> Ist der Abrechnungszeitraum/ Ausführungsdatum der Rechnung bereits in einer vorhergehenden, akzeptierten und nicht stornierten Rechnung enthalten?) then (ja)
    :A07;
    note left
        Cluster: Ablehnung auf Kopfebene
        Die Rechnung enthält ein bereits abgerechnetes Zeitintervall/ einen bereits abgerechneten Zeitpunkt.
    endnote
    kill;
else (nein)
endif
if (<b>80: </b> Ist der fällige Betrag ≥ Null?) then (ja)
else (nein)
    :A08;
    note left
        Cluster: Ablehnung auf Kopfebene
        Bei der Abrechnung kann es nicht zu einer Rückerstattung kommen.
    endnote
    kill;
endif
if (<b>90: </b> Ist die Frist der Fälligkeit unterschritten?
(Zahlungsziel ≤ 10 WT zum Rechnungseingangsdatum&#41;) then (ja)
    :A09;
    note left
        Cluster: Ablehnung auf Kopfebene
        Das Zahlungsziel ist unterschritten.
    endnote
    kill;
else (nein)
endif
if (<b>100: </b> Handelt es sich um eine Geräteübernahme (Kauf/ Nutzungsüberlassung&#41;?) then (ja)
    if (<b>110: </b> Wurde das in der Rechnung genannte Angebot des MSB in der Bestellbestätigung im Prozess Geräteübernahme für diese Messlokation bestätigt?) then (ja)
    else (nein)
        :A10;
        note left
            Cluster: Ablehnung auf Kopfebene
            Das Angebot des MSB in der Bestellbestätigung im Prozess Geräteübernahme für diese Messlokation wurde nicht bestätigt.
        endnote
        kill;
    endif
    if (<b>120: </b> Ist die in der Rechnung genannte Bestellung die jüngste bestätigte Bestellung, die genau zu diesem Zeitpunkt beginnt?) then (ja)
    else (nein)
        :A11;
        note left
            Cluster: Ablehnung auf Kopfebene
            Die Referenz erfolgt nicht auf die jüngste Bestellung zu diesem Zeitpunkt.
        endnote
        kill;
    endif
    if (<b>130: </b> Ist ein zuvor nicht spezifizierter Fehler im Kopfteil der Rechnung aufgetreten?) then (ja)
        :A90;
        note left
            Cluster: Ablehnung auf Kopfebene
            Sonstiger Fehler auf Kopfebene.
            Hinweis: Das identifizierte Problem ist in der Antwort zu beschreiben/benennen. Nutzungsmöglichkeit Ende: 01.10.2026 00:00 Uhr
        endnote
        kill;
    else (nein)
    endif
    if (<b>300: </b> Handelt es sich um eine Geräteübernahme (Kauf/ Nutzungsüberlassung&#41;?) then (ja)
        if (<b>310: </b> Entspricht die Rechnungsposition dem bestätigten Angebot?) then (ja)
        else (nein)
            :A12;
            note left
                Cluster: Ablehnung auf Positionsebene
                Die Rechnungsposition entspricht nicht dem bestätigten Angebot.
            endnote
        endif
    else (nein)
    endif
    if (<b>320: </b> Wird für die Rechnungsposition der für diesen Zeitraum korrekte gültige Umsatzsteuersatz angegeben?) then (ja)
    else (nein)
        :A13;
        note left
            Cluster: Ablehnung auf Positionsebene
            Der gültige Umsatzsteuersatz für die Rechnungsposition für diesen Zeitraum wurde nicht korrekt angegeben.
        endnote
    endif
    if (<b>330: </b> Ist das Enddatum der Rechnungsposition gleich oder nach dem Enddatum des Abrechnungszeitraums / Ausführungsdatums?) then (ja)
        :A14;
        note left
            Cluster: Ablehnung auf Positionsebene
            Das Enddatum der Rechnungsposition ist gleich oder nach dem Enddatum des Abrechnungszeitraums/ Ausführungsdatums.
        endnote
    else (nein)
    endif
    if (<b>340: </b> Ist das Beginndatum der Rechnungsposition vor oder gleich dem Beginndatum des Abrechnungszeitraums?
Hinweis: Bei Nutzung des Ausführungsdatums in der Rechnung Prüfschritt mit ja beantworten.) then (ja)
        :A15;
        note left
            Cluster: Ablehnung auf Positionsebene
            Das Beginndatum der Rechnungsposition liegt vor dem Beginndatum des Abrechnungszeitraums.
        endnote
    else (nein)
    endif
    if (<b>345: </b> Wird mit der Rechnungsposition der richtige Abrechnungszeitraum abgerechnet?) then (ja)
    else (nein)
        :A25;
        note left
            Cluster: Ablehnung auf Positionsebene
            Falscher Abrechnungszeitraum wird abgerechnet.
            Hinweis: Der LF gibt den erwarteten Abrechnungszeitraum an.
        endnote
    endif
    if (<b>350: </b> Entspricht der Preis in der Position dem vereinbarten Preis?) then (ja)
    else (nein)
        :A16;
        note left
            Cluster: Ablehnung auf Positionsebene
            Der Preis in der Rechnungsposition passt nicht zum vereinbarten Preis.
        endnote
    endif
    if (<b>360: </b> Liegt ein Rechenfehler in der Rechnungsposition vor?) then (ja)
        :A17;
        note left
            Cluster: Ablehnung auf Positionsebene
            Rechenfehler liegt vor.
        endnote
    else (nein)
    endif
    if (<b>370: </b> Ist in der Rechnungsposition ein zuvor nicht spezifizierter Fehler aufgetreten?) then (ja)
        :A99;
        note left
            Cluster: Ablehnung auf Positionsebene 
            Sonstiger Fehler auf Positionsebene.
            Hinweis: Das identifizierte Problem ist in der Antwort zu beschreiben/benennen. Nutzungsmöglichkeit Ende: 01.10.2026 00:00 Uhr
        endnote
    else (nein)
    endif
    if (<b>380: </b> Sind noch weitere Rechnungspositionen zu prüfen?) then (ja)
    else (nein)
        if (<b>390: </b> Ist in mindestens einer Rechnungspositionen ein Fehler aufgetreten?) then (ja)
            :Hinweis: Alle erkannten Antwortcodes aus der Positionsebene sind für jeden fehlerhaft identifizierten Positionsteil unter Angabe der Positionsnummer zu übermitteln.;
            kill;
        else (nein)
        endif
        if (<b>500: </b> Fehlen vereinbarte Positionen in der Rechnung?) then (ja)
            :A18;
            note left
                Cluster: Ablehnung auf Summenebene
                Erwartete Position nicht vorhanden.
                Hinweis: Fehlende Positionen sind im Freitextfeld zu beschreiben.
            endnote
            kill;
        else (nein)
        endif
        if (<b>510: </b> Entspricht für den genannten Steuersatz die Besteuerungsgrundlage der Summen der Einzelpositionen dieser Rechnung mit diesem Steuersatz?) then (ja)
        else (nein)
            :A19;
            note left
                Cluster: Ablehnung auf Summenebene
                Genannte Besteuerungsgrundlage passt nicht zu der Summe der Einzelpositionen des Steuersatzes.
                Hinweis: Es ist der Steuersatz (aus DE5278&#41; und die Steuerkategorie (aus DE5305&#41; des SG52 TAX zu nennen.
            endnote
        endif
        if (<b>520: </b> Entspricht für diesen Steuersatz die Angabe des Steuerbetrages der Summe aller Rechnungspositionen (Netto&#41; dieser Rechnung, denen dieser Steuersatz zugeordnet ist, multipliziert mit diesem Steuersatz?) then (ja)
        else (nein)
            :A20;
            note left
                Cluster: Ablehnung auf Summenebene 
                Summe aller Rechnungspositionen (Netto&#41; dieser Rechnung, denen dieser Steuersatz zugeordnet ist, multipliziert mit diesem Steuersatz entspricht nicht der Angabe des Steuerbetrages für diesen Steuersatz.
                Hinweis: Es ist der Steuersatz (aus DE5278&#41; und die Steuerkategorie (aus DE5305&#41; des SG52 TAX zu nennen.
            endnote
        endif
        if (<b>530: </b> Sind noch weitere Steuersätze zu prüfen?) then (ja)
        else (nein)
            if (<b>540: </b> Entspricht der Rechnungsbetrag der Summe aller Rechnungspositionen (Besteuerungsgrundlage&#41; zzgl. dem jeweiligen Steuerbetrag?) then (ja)
            else (nein)
                :A21;
                note left
                    Cluster: Ablehnung auf Summenebene
                    Rechnungsbetrag (Besteuerungsgrundlage inklusive Steuerbetrag&#41; der Summe ist nicht korrekt.
                endnote
            endif
            if (<b>550: </b> Ist ein zuvor nicht spezifizierter Fehler im Summenteil aufgetreten?) then (ja)
                :A96;
                note left
                    Cluster: Ablehnung auf Summenebene
                    Sonstiges
                    Hinweis: Das identifizierte Problem ist in der Antwort zu beschreiben/benennen.
                    Nutzungsmöglichkeit Ende: 01.10.2026 00:00 Uhr
                endnote
            else (nein)
            endif
            if (<b>560: </b> Ist mindestens ein Fehler in der Summenebene aufgetreten?) then (ja)
                :Cluster: Ablehnung auf Summenebene
Hinweis: Alle erkannten Antwortcodes aus der Summenebene sind zu übermitteln.;
                kill;
            else (nein)
                :Cluster: Zustimmung 
Zahlung der Rechnung avisieren und im Zahlungslauf berücksichtigen.;
                kill;
            endif
        endif
    endif
else (nein)
endif
if (<b>130: </b> Ist ein zuvor nicht spezifizierter Fehler im Kopfteil der Rechnung aufgetreten?) then (ja)
    :A90;
    note left
        Cluster: Ablehnung auf Kopfebene
        Sonstiger Fehler auf Kopfebene.
        Hinweis: Das identifizierte Problem ist in der Antwort zu beschreiben/benennen. Nutzungsmöglichkeit Ende: 01.10.2026 00:00 Uhr
    endnote
    kill;
else (nein)
endif
if (<b>300: </b> Handelt es sich um eine Geräteübernahme (Kauf/ Nutzungsüberlassung&#41;?) then (ja)
    if (<b>310: </b> Entspricht die Rechnungsposition dem bestätigten Angebot?) then (ja)
    else (nein)
        :A12;
        note left
            Cluster: Ablehnung auf Positionsebene
            Die Rechnungsposition entspricht nicht dem bestätigten Angebot.
        endnote
    endif
else (nein)
endif
if (<b>320: </b> Wird für die Rechnungsposition der für diesen Zeitraum korrekte gültige Umsatzsteuersatz angegeben?) then (ja)
else (nein)
    :A13;
    note left
        Cluster: Ablehnung auf Positionsebene
        Der gültige Umsatzsteuersatz für die Rechnungsposition für diesen Zeitraum wurde nicht korrekt angegeben.
    endnote
endif
if (<b>330: </b> Ist das Enddatum der Rechnungsposition gleich oder nach dem Enddatum des Abrechnungszeitraums / Ausführungsdatums?) then (ja)
    :A14;
    note left
        Cluster: Ablehnung auf Positionsebene
        Das Enddatum der Rechnungsposition ist gleich oder nach dem Enddatum des Abrechnungszeitraums/ Ausführungsdatums.
    endnote
else (nein)
endif
if (<b>340: </b> Ist das Beginndatum der Rechnungsposition vor oder gleich dem Beginndatum des Abrechnungszeitraums?
Hinweis: Bei Nutzung des Ausführungsdatums in der Rechnung Prüfschritt mit ja beantworten.) then (ja)
    :A15;
    note left
        Cluster: Ablehnung auf Positionsebene
        Das Beginndatum der Rechnungsposition liegt vor dem Beginndatum des Abrechnungszeitraums.
    endnote
else (nein)
endif
if (<b>345: </b> Wird mit der Rechnungsposition der richtige Abrechnungszeitraum abgerechnet?) then (ja)
else (nein)
    :A25;
    note left
        Cluster: Ablehnung auf Positionsebene
        Falscher Abrechnungszeitraum wird abgerechnet.
        Hinweis: Der LF gibt den erwarteten Abrechnungszeitraum an.
    endnote
endif
if (<b>350: </b> Entspricht der Preis in der Position dem vereinbarten Preis?) then (ja)
else (nein)
    :A16;
    note left
        Cluster: Ablehnung auf Positionsebene
        Der Preis in der Rechnungsposition passt nicht zum vereinbarten Preis.
    endnote
endif
if (<b>360: </b> Liegt ein Rechenfehler in der Rechnungsposition vor?) then (ja)
    :A17;
    note left
        Cluster: Ablehnung auf Positionsebene
        Rechenfehler liegt vor.
    endnote
else (nein)
endif
if (<b>370: </b> Ist in der Rechnungsposition ein zuvor nicht spezifizierter Fehler aufgetreten?) then (ja)
    :A99;
    note left
        Cluster: Ablehnung auf Positionsebene 
        Sonstiger Fehler auf Positionsebene.
        Hinweis: Das identifizierte Problem ist in der Antwort zu beschreiben/benennen. Nutzungsmöglichkeit Ende: 01.10.2026 00:00 Uhr
    endnote
else (nein)
endif
if (<b>380: </b> Sind noch weitere Rechnungspositionen zu prüfen?) then (ja)
else (nein)
    if (<b>390: </b> Ist in mindestens einer Rechnungspositionen ein Fehler aufgetreten?) then (ja)
        :Hinweis: Alle erkannten Antwortcodes aus der Positionsebene sind für jeden fehlerhaft identifizierten Positionsteil unter Angabe der Positionsnummer zu übermitteln.;
        kill;
    else (nein)
    endif
    if (<b>500: </b> Fehlen vereinbarte Positionen in der Rechnung?) then (ja)
        :A18;
        note left
            Cluster: Ablehnung auf Summenebene
            Erwartete Position nicht vorhanden.
            Hinweis: Fehlende Positionen sind im Freitextfeld zu beschreiben.
        endnote
        kill;
    else (nein)
    endif
    if (<b>510: </b> Entspricht für den genannten Steuersatz die Besteuerungsgrundlage der Summen der Einzelpositionen dieser Rechnung mit diesem Steuersatz?) then (ja)
    else (nein)
        :A19;
        note left
            Cluster: Ablehnung auf Summenebene
            Genannte Besteuerungsgrundlage passt nicht zu der Summe der Einzelpositionen des Steuersatzes.
            Hinweis: Es ist der Steuersatz (aus DE5278&#41; und die Steuerkategorie (aus DE5305&#41; des SG52 TAX zu nennen.
        endnote
    endif
    if (<b>520: </b> Entspricht für diesen Steuersatz die Angabe des Steuerbetrages der Summe aller Rechnungspositionen (Netto&#41; dieser Rechnung, denen dieser Steuersatz zugeordnet ist, multipliziert mit diesem Steuersatz?) then (ja)
    else (nein)
        :A20;
        note left
            Cluster: Ablehnung auf Summenebene 
            Summe aller Rechnungspositionen (Netto&#41; dieser Rechnung, denen dieser Steuersatz zugeordnet ist, multipliziert mit diesem Steuersatz entspricht nicht der Angabe des Steuerbetrages für diesen Steuersatz.
            Hinweis: Es ist der Steuersatz (aus DE5278&#41; und die Steuerkategorie (aus DE5305&#41; des SG52 TAX zu nennen.
        endnote
    endif
    if (<b>530: </b> Sind noch weitere Steuersätze zu prüfen?) then (ja)
    else (nein)
        if (<b>540: </b> Entspricht der Rechnungsbetrag der Summe aller Rechnungspositionen (Besteuerungsgrundlage&#41; zzgl. dem jeweiligen Steuerbetrag?) then (ja)
        else (nein)
            :A21;
            note left
                Cluster: Ablehnung auf Summenebene
                Rechnungsbetrag (Besteuerungsgrundlage inklusive Steuerbetrag&#41; der Summe ist nicht korrekt.
            endnote
        endif
        if (<b>550: </b> Ist ein zuvor nicht spezifizierter Fehler im Summenteil aufgetreten?) then (ja)
            :A96;
            note left
                Cluster: Ablehnung auf Summenebene
                Sonstiges
                Hinweis: Das identifizierte Problem ist in der Antwort zu beschreiben/benennen.
                Nutzungsmöglichkeit Ende: 01.10.2026 00:00 Uhr
            endnote
        else (nein)
        endif
        if (<b>560: </b> Ist mindestens ein Fehler in der Summenebene aufgetreten?) then (ja)
            :Cluster: Ablehnung auf Summenebene
Hinweis: Alle erkannten Antwortcodes aus der Summenebene sind zu übermitteln.;
            kill;
        else (nein)
            :Cluster: Zustimmung 
Zahlung der Rechnung avisieren und im Zahlungslauf berücksichtigen.;
            kill;
        endif
    endif
endif

@enduml
